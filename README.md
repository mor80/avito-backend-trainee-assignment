# avito-backend-trainee-assignment

## Запуск сервиса

```sh
make docker-up # или же просто docker compose up
```

## Архитектура 

1. Handlers (`internal/handlers`)  
Chi-контроллеры + DTO. Контракты (`contract.go`) описывают, какие методы ожидают от сервисов  
  
2. Services (`internal/service`)  
Бизнес-логика. Сервисы зависят от публичных интерфейсов репозиториев (описаны в `internal/service/contract.go`)  
  
3. Repositories (`internal/repository/postgres`)
Доступ к БД на pgxpool. Каждый репозиторий реализует методы из сервисного контракта

## API

### Общая информация

API сервиса реализовал в соответствии со спецификацией, находящейся в файле `api/openapi/v1/openapi.yml`

### Дополнительно

Сделал доп ручки:
1. GET `/stats/assignments` - возвращает количество пул-реквестов по пользователям
2. POST `/team/deactivateMembers` - делает всех членов команды не активными

### Нагрузочное тестирование

Сделал его с помощью k6 (что первое нашел в интернете)  
Код лежит в `loadtest/pr_load_test.js`  
Для запуска внутри кода необходимо в переменной `BASE_URL` указать путь до сервера. Также нужно было, чтобы существовал пользователь с id "u1"

```sh {"terminalRows":"22"}
BASE_URL=http://localhost:8080 k6 run loadtest/pr_load_test.js
```

## Линтер

Использую golangci-lint, как самый базовый. Конфигурация находится в файле `.golangci.yml`. Можно вызвать через команду ниже

```sh
make lint
```

## С какими вопросами столкнулся

1. Что делать с при создании команды. Я реализовал это через транзакции, но у меня создание команды и создание пользователей это разные транзакции
2. Что возвращать в случае если команда пуста или нет ревьюеров у пр. Я решил возвращать null

## PS

Для запуска первой миграции сделал отдельный Dockerfile `goose/Dockerfile`